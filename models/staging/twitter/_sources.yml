version: 2

sources:
  - name: twitter
    database: hive_metastore
    schema: dbt_sdurry
    quoting:
      schema: true
      identifier: true
    loader: Databricks notebook
    tables:
      - name: tweets
        identifier: raw_tweets
        description: >- 
          "Stream of Tweets ingested via Twitter API v2. Exposed using a DLT `CREATE STREAMING LIVE TABLE` statement
          [Link to notebook](https://dbc-c7c89cba-cf9b.cloud.databricks.com/#notebook/282962185456694/command/282962185456695)
          [Link to DLT Pipeline](https://dbc-c7c89cba-cf9b.cloud.databricks.com/?o=3718560678585456#joblist/pipelines/ec0633bc-a9a3-4c08-8e50-6e8c61b380b9/updates/f22aee9d-9d55-4d15-bb18-8c0dc8242080)
          **For cost reasons this script is scheduled and only illustrates streaming data.**"
        meta:
          owner: stephan.durry@dbtlabs.com
        freshness:
          warn_after: {count: 12, period: hour}
          error_after: {count: 24, period: hour}
        loaded_at_field: cast(created_at as timestamp)
        columns:
          - name: id
            tests:
              - unique
              - not_null
          - name: attachments
          - name: author_id
          - name: context_annotations
          - name: conversation_id
          - name: created_at
          - name: data
          - name: entities
          - name: geo
          - name: id
          - name: in_reply_to_user_id
          - name: lang
          - name: non_public_metrics
          - name: organic_metrics
          - name: possibly_sensitive
          - name: promoted_metrics
          - name: public_metrics
          - name: referenced_tweets
          - name: reply_settings
          - name: source
          - name: text
          - name: withheld
          - name: _rescued_data

      - name: tweet_metrics
        identifier: raw_tweet_metrics
        description: >-
          "Batch data of tweet metrics ingested once a day. Exposed using a DLT `CREATE STREAMING LIVE TABLE` statement.
          [Link to notebook](https://dbc-c7c89cba-cf9b.cloud.databricks.com/?o=3718560678585456#notebook/2754430239328354/command/2754430239328357)
          [Link to DLT Pipeline](https://dbc-c7c89cba-cf9b.cloud.databricks.com/?o=3718560678585456#joblist/pipelines/ec0633bc-a9a3-4c08-8e50-6e8c61b380b9/updates/f22aee9d-9d55-4d15-bb18-8c0dc8242080)"
        meta:
          owner: stephan.durry@dbtlabs.com
        freshness:
          warn_after: {count: 1, period: day}
          error_after: {count: 2, period: day}
        loaded_at_field: cast(updated_at as timestamp)
        columns:
          - name: id
            tests:
              - not_null
          - name: public_metrics.like_count
            quote: true
          - name: public_metrics.retweet_count
            quote: true
          - name: public_metrics.quote_count
            quote: true
          - name: public_metrics.reply_count
            quote: true
          - name: updated_at
          - name: rescued_data
